<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Empress PDF → JPG Converter</title>
  <style>
    :root { --bg:#0b1220; --card:#121a2b; --muted:#9fb0d1; --accent:#6aa9ff; }
    html,body { height:100%; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial; background:var(--bg); color:#e6eefc; }
    .wrap { max-width: 1000px; margin: 24px auto; padding: 16px; }
    .card { background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding: 16px; box-shadow: 0 6px 30px rgba(0,0,0,.25); }
    h1 { font-size: 20px; margin: 0 0 6px; }
    p { color: var(--muted); margin: 6px 0 16px; }
    .controls { display: grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap:12px; align-items: end; }
    .control { display:flex; flex-direction:column; gap:6px; }
    label { font-size: 12px; color:#c8d6ef; }
    input[type="file"], select, button, input[type="number"] { 
      background:#0c1426; color:#e6eefc; border:1px solid rgba(255,255,255,.1); border-radius:10px; padding:10px 12px; 
    }
    button { cursor:pointer; font-weight:600; }
    button.primary { background: linear-gradient(135deg, #3b82f6, #06b6d4); border:none; }
    button[disabled] { opacity:.6; cursor:not-allowed; }

    .dropzone { border:2px dashed rgba(255,255,255,.15); border-radius:14px; padding:16px; text-align:center; color:var(--muted); }
    .thumbs { display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:12px; margin-top:12px; }
    .thumb { position:relative; border:1px solid rgba(255,255,255,.1); border-radius:12px; overflow:hidden; background:#0c1426; }
    .thumb img { width:100%; height:120px; object-fit:cover; display:block; }
    .thumb .meta { display:flex; align-items:center; justify-content:space-between; padding:8px; gap:6px; font-size:12px; color:#c8d6ef; }
    .thumb .actions { display:flex; gap:6px; }
    .thumb button { padding:6px 8px; font-size:12px; }
    .drag-hint { position:absolute; inset:0; display:none; }
    .thumb.dragover .drag-hint { display:block; outline:3px dashed var(--accent); outline-offset:-6px; }

    .footer { display:flex; gap:12px; justify-content:flex-end; margin-top:16px; }

    .progress { height:10px; background:#0c1426; border:1px solid rgba(255,255,255,.1); border-radius:999px; overflow:hidden; }
    .bar { height:100%; width:0%; background:linear-gradient(90deg,#3b82f6,#22d3ee); transition: width .2s ease; }

    .muted { color: var(--muted); font-size:12px; }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .controls {
        grid-template-columns: 1fr;
      }
      .control {
        grid-column: span 1 !important;
      }
    }
  </style>
</head>
<body>
     <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="nav-logo">
        <span>Empress</span> Converter Suite
      </a>
      
      <button class="mobile-menu-btn" id="mobileMenuBtn">☰</button>
      
      <ul class="nav-menu" id="navMenu">
        <li class="nav-item">
          <a href="index.html" class="nav-link">Home</a>
        </li>
        <li class="nav-item">
          <a href="jpg2pdf.html" class="nav-link">JPG to PDF</a>
        </li>
        <li class="nav-item">
          <a href="pdf2jpg.html" class="nav-link active">PDF to JPG</a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="wrap">
    <div class="card">
      <h1> Empress PDF → JPG Converter </h1>
      <p>Upload a PDF file to convert each page to a JPG image. All processing happens in your browser.</p>

      <div class="controls">
        <div class="control" style="grid-column: span 3;">
          <label>Choose PDF file</label>
          <input id="fileInput" type="file" accept=".pdf" />
        </div>
        <div class="control">
          <label>Image Quality</label>
          <select id="quality">
            <option value="0.7">Good (70%)</option>
            <option value="0.8">Better (80%)</option>
            <option value="0.9">Best (90%)</option>
            <option value="1.0">Maximum (100%)</option>
          </select>
        </div>
        <div class="control">
          <label>Resolution Scale</label>
          <select id="resolution">
            <option value="1.0">Standard (1x)</option>
            <option value="1.5">High (1.5x)</option>
            <option value="2.0">Very High (2x)</option>
          </select>
        </div>
        <div class="control">
          <button id="clearBtn" type="button">Clear</button>
        </div>
        <div class="control">
          <button id="exportBtn" class="primary" type="button" disabled>Convert → JPGs</button>
        </div>
      </div>

      <div id="dropzone" class="dropzone" style="margin-top:12px;">
        Drag & drop PDF here (or use the file picker above)
      </div>

      <div id="thumbs" class="thumbs" aria-live="polite"></div>

      <div class="footer">
        <div class="progress" style="flex:1; display:none;" id="progress">
          <div class="bar" id="bar"></div>
        </div>
        <span class="muted" id="hint">PDF pages will appear here after conversion</span>
      </div>
    </div>
  </div>

  <!-- pdf.js for PDF rendering -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <!-- JSZip for creating zip files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <!-- FileSaver for saving files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <script>
    // State
    const state = { items: [] }; // { id, pageNum, dataUrl, name }
    const fileInput = document.getElementById('fileInput');
    const thumbs = document.getElementById('thumbs');
    const exportBtn = document.getElementById('exportBtn');
    const clearBtn = document.getElementById('clearBtn');
    const dropzone = document.getElementById('dropzone');
    const qualitySel = document.getElementById('quality');
    const resolutionSel = document.getElementById('resolution');
    const bar = document.getElementById('bar');
    const progress = document.getElementById('progress');
    const hint = document.getElementById('hint');

    // Set PDF.js worker path
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    // Helpers
    const uid = () => Math.random().toString(36).slice(2,9);

    function readFileAsArrayBuffer(file){
      return new Promise((resolve,reject)=>{
        const fr = new FileReader();
        fr.onload = () => resolve(fr.result);
        fr.onerror = reject;
        fr.readAsArrayBuffer(file);
      });
    }

    async function processPDF(file) {
      if (!file || !file.type.includes('pdf')) {
        alert("Please select a PDF file");
        return;
      }

      progress.style.display = 'block';
      bar.style.width = '0%';
      hint.textContent = "Processing PDF...";

      try {
        const arrayBuffer = await readFileAsArrayBuffer(file);
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        const numPages = pdf.numPages;
        
        state.items = []; // Clear previous items
        
        for (let i = 1; i <= numPages; i++) {
          bar.style.width = ((i-1)/numPages*100).toFixed(1)+'%';
          
          const page = await pdf.getPage(i);
          const viewport = page.getViewport({ scale: parseFloat(resolutionSel.value) });
          
          // Create canvas
          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          
          // Render PDF page to canvas
          await page.render({
            canvasContext: context,
            viewport: viewport
          }).promise;
          
          // Convert to data URL
          const dataUrl = canvas.toDataURL('image/jpeg', parseFloat(qualitySel.value));
          
          // Add to state
          state.items.push({
            id: uid(),
            pageNum: i,
            dataUrl: dataUrl,
            name: `${file.name.replace('.pdf', '')}_page_${i}.jpg`
          });
        }
        
        bar.style.width = '100%';
        render();
        hint.textContent = `Converted ${numPages} page${numPages !== 1 ? 's' : ''} to JPG`;
      } catch (error) {
        console.error('Error processing PDF:', error);
        alert('Error processing PDF: ' + error.message);
      } finally {
        progress.style.display = 'none';
      }
    }

    function render(){
      thumbs.innerHTML='';
      state.items.forEach((it,idx)=>{
        const el = document.createElement('div');
        el.className='thumb';
        el.innerHTML = `
          <img src="${it.dataUrl}" alt="${it.name}" />
          <div class="meta">
            <span title="${it.name}">Page ${it.pageNum}</span>
            <div class="actions">
              <button type="button" data-act="download" title="Download">↓</button>
            </div>
          </div>`;
        
        // Download button action
        el.querySelector('button').addEventListener('click', () => {
          const link = document.createElement('a');
          link.href = it.dataUrl;
          link.download = it.name;
          link.click();
        });
        
        thumbs.appendChild(el);
      });
      exportBtn.disabled = state.items.length === 0;
    }

    // Export all images as ZIP
    async function exportJPGs(){
      if(state.items.length === 0) return;
      
      progress.style.display = 'block';
      bar.style.width = '0%';
      
      try {
        const zip = new JSZip();
        
        for(let i = 0; i < state.items.length; i++){
          const it = state.items[i];
          // Convert data URL to blob
          const response = await fetch(it.dataUrl);
          const blob = await response.blob();
          
          // Add to zip
          zip.file(it.name, blob);
          
          bar.style.width = ((i+1)/state.items.length*100).toFixed(1)+'%';
          await new Promise(r => setTimeout(r, 0)); // yield to UI
        }
        
        // Generate and download zip
        const zipBlob = await zip.generateAsync({type: 'blob'});
        saveAs(zipBlob, 'converted_pages.zip');
      } catch (error) {
        console.error('Error creating ZIP:', error);
        alert('Error creating ZIP file: ' + error.message);
      } finally {
        progress.style.display = 'none';
      }
    }

    // Events
    fileInput.addEventListener('change', e => {
      if (e.target.files.length > 0) {
        processPDF(e.target.files[0]);
      }
    });

    clearBtn.addEventListener('click', () => { 
      state.items.length = 0; 
      render(); 
      fileInput.value = '';
      hint.textContent = "PDF pages will appear here after conversion";
    });

    exportBtn.addEventListener('click', exportJPGs);

    // Drag & drop support
    ;['dragenter','dragover'].forEach(evt => {
      dropzone.addEventListener(evt, e => { 
        e.preventDefault(); 
        dropzone.style.background='#0f1930'; 
      });
    });
    ;['dragleave','drop'].forEach(evt => {
      dropzone.addEventListener(evt, e => { 
        e.preventDefault(); 
        dropzone.style.background=''; 
      });
    });
    dropzone.addEventListener('drop', e => {
      const dt = e.dataTransfer; 
      if(!dt || !dt.files) return; 
      
      const pdfFiles = Array.from(dt.files).filter(f => f.type.includes('pdf'));
      if (pdfFiles.length > 0) {
        processPDF(pdfFiles[0]);
      }
    });
  
    // Mobile menu functionality
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const navMenu = document.getElementById('navMenu');
    
    mobileMenuBtn.addEventListener('click', () => {
      navMenu.classList.toggle('active');
    });
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.nav-container') && navMenu.classList.contains('active')) {
        navMenu.classList.remove('active');
      }
    });
    
    // Update active link based on current page
    document.addEventListener('DOMContentLoaded', () => {
      const currentPage = window.location.pathname.split('/').pop() || 'index.html';
      const links = document.querySelectorAll('.nav-link');
      
      links.forEach(link => {
        const linkPage = link.getAttribute('href');
        if (linkPage === currentPage) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
    });
 
  </script>


  <footer class="wrap" style="opacity:.8;">
    <p class="muted">
      Notes: Works fully offline after load. Large PDFs may take longer to process. For best results, use high resolution setting for better quality images.
    </p>
  </footer>
</body>
</html>